# Feature Specification: PD-002 - Advanced Edge Anchor Points

- **Status:** To Do
- **Epic:** Core Rendering Engine
- **Author:** Gemini
- **Created:** 2025-07-14

---

### 1. Problem Statement

When creating a self-referencing edge to represent an iteration, the connection points are limited. Using anchors like `bottom_center` to `center_right` resulted in the arrow being drawn partially inside the node, which is visually incorrect. The desired behavior is for the arrow to loop entirely outside the node's boundary.

### 2. Proposed Solution

Expand the available anchor points for edges beyond the current set. The new anchor points will allow for more precise connections at the corners and midpoints of the node's bounding box.

**New Anchor Points:**
- `top_left`, `top_right`
- `bottom_left`, `bottom_right`

This will allow for connections like `bottom_right` to `top_right` for a clean external loop.

### 3. Technical Details

- The `drawer/addons/edge.py` module will be updated to recognize and calculate coordinates for the new anchor points.
- The logic will need to retrieve the node's `(x, y)` position and its `size` to calculate the corner coordinates.
- For a self-referencing loop from `bottom_right` to `top_right`, the curve's control points should be calculated to extend outwards from the right side of the node before looping back.

**Example `edges.json` modification:**

```json
{
    "source_id": "recommend_box_4",
    "target_id": "recommend_box_4",
    "source_anchor": "bottom_right", // New anchor
    "target_anchor": "top_right",   // New anchor
    "connection": {
        "type": "curve",
        "bend": -0.8
    }
}
```

### 4. Acceptance Criteria

1.  Given an edge with `source_anchor: "bottom_right"` and `target_anchor: "top_right"`, the edge connects to the respective corners of the nodes.
2.  Given a self-referencing edge using the new corner anchors, the entire edge path renders outside the node's border.
3.  The new anchor points work correctly for connections between two different nodes.
