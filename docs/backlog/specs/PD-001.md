# Feature Specification: PD-001 - Automatic Text Wrapping in Nodes

- **Status:** To Do
- **Epic:** Core Rendering Engine
- **Author:** Gemini
- **Created:** 2025-07-14

---

### 1. Problem Statement

When defining a `label` for a shape node, long strings of text do not automatically wrap to fit within the node's boundaries. This forces users to manually calculate where to insert newline characters (`\\n`) in their JSON definitions, which is tedious, error-prone, and not responsive to changes in node width. This was a primary issue encountered during our diagram creation process.

### 2. Proposed Solution

Modify the rendering engine to automatically wrap text for `label` properties within shape nodes. The wrapping algorithm should consider the node's width (minus a configurable padding) and the font metrics of the specified text.

A new optional property, `wrapping`, will be added to the `label` object.

- `wrapping: "auto"` (default): Enables automatic word wrapping.
- `wrapping: "none"`: Disables automatic wrapping, preserving the current behavior where only manual `\\n` characters create new lines.

### 3. Technical Details

- The text rendering function in `drawer/addons/text.py` will need to be updated.
- It should calculate the width of each word based on the given font and size.
- When a line of text exceeds `node.width - (2 * padding)`, the function will break the line at the last space and start a new line.
- A default padding of `10px` will be used.

**Example `nodes.json` modification:**

```json
{
    "id": "my_node",
    "type": "shape",
    "shape": "rounded_rectangle",
    "size": [ 200, 150 ],
    "label": {
        "text": "This is a very long line of text that should wrap automatically.",
        "position": "center",
        "wrapping": "auto" // This would be the new default
    }
}
```

### 4. Acceptance Criteria

1.  Given a node with a `label` and `wrapping: "auto"`, the text wraps automatically to fit within the node's width.
2.  Given a node with `wrapping: "none"`, text only wraps where a manual `\\n` is present.
3.  The wrapping algorithm correctly handles words that are longer than the node's width (e.g., by breaking the word).
4.  The vertical alignment of the wrapped text block still respects the `position` property (e.g., "center").
